<script src="/javascripts/prettydate.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
$(function(){
	$('.pubdate').each(function(i,e){
		date = new Date($(this).text());
		$(this).text(pretty(date))
		
	});
	
	$('input[type=checkbox]').change(function(){
		if($('input[type=checkbox]:checked').length == 0) {
			$('#delete-episodes').attr('disabled', 'disabled');
		} else {
			$('#delete-episodes').removeAttr('disabled');
		}
		
	});
});

pretty = function(date) {
	var diff = (((new Date()).getTime() - date.getTime()) / 1000),
			day_diff = Math.floor(diff / 86400);
	
	if ( isNaN(day_diff) || day_diff < 0 || day_diff >= 31 )
			 date.getMonth()+'/'+date.getDay()+'/'+date.getFullYear();
	
	return day_diff == 0 && (
				diff < 60 && "just now" ||
				diff < 120 && "1 minute ago" ||
				diff < 3600 && Math.floor( diff / 60 ) + " minutes ago" ||
				diff < 7200 && "1 hour ago" ||
				diff < 86400 && Math.floor( diff / 3600 ) + " hours ago") ||
			day_diff == 1 && "Yesterday" ||
			day_diff < 7 && day_diff + " days ago" ||
			day_diff < 31 && Math.ceil( day_diff / 7 ) + " weeks ago";
}
</script>


{{#has_episodes}}
<form method="post" class="form-stacked" action="/admin/episode/delete">
<div class="row">
	<div class="span16 columns">
		<table class="zebra-striped">
			<thead>
				<tr>
					<th>&nbsp;</th>

					<th class="episode-title">Title</th>
					<th>Published</th>
					<th>Status</th>
					<th>Stats</th>
				</tr>
			</thead>
			<tbody>
				{{#episodes}}
				<tr>
					<td><input type="checkbox" name="episode[{{_id}}]" value="{{_id}}"/></td>

					<td class="episode-title"><a href="/admin/episode/{{_id}}">{{title}}</a> {{^processed}}<em>(processing)</em>{{/processed}}</td>
					<td class="pubdate">{{published}}</td>
					<td>{{release}}</td>

					<td>{{#meta}}
						{{views}}{{^views}}0 {{/views}}
						 - {{plays}}{{^plays}}0 {{/plays}}
						 - {{downloads}}{{^downloads}}0 {{/downloads}}
					{{/meta}}</td>

				</tr>
				{{/episodes}}
			</tbody>
		</table>
		<button id="delete-episodes" type="submit" class="btn danger" disabled>Delete Selected</button>
		<a class="btn small" href="/admin/publish">Publish a New Episode</a>
	</div>
</div>
</form>
{{/has_episodes}}



{{^episodes}}
<h1>Nothing Published</h1>
<p>Maybe try <a href="/admin/publish">publishing</a> something?</p>
{{/episodes}}